<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


    <!-- Bootstrap -->
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/css/style.css">


</head>

<body>



    <div class="container-fluid mt-5">
        <h2>Morning Out</h2>

        <table class="Table">
            <thead>
                <th>No.</th>
                <th>Course</th>
                <th>Department</th>
                <th>Full Name</th>
                <th>Year</th>
                <th>Time</th>
            </thead>

            <tbody id="tbody1">


            </tbody>
        </table>

        <button class="my-5" onclick="tableToExcel()">Export to Excel</button>

    </div>


    <script type="module">

        let userNo = 0;
        let tbody = document.getElementById('tbody1');

        function AddItemToTable(course, department, fullname, year, time) {
            let trow = document.createElement('tr');
            let td1 = document.createElement('td');
            let td2 = document.createElement('td');
            let td3 = document.createElement('td');
            let td4 = document.createElement('td');
            let td5 = document.createElement('td');
            let td6 = document.createElement('td');
            // let td7 = document.createElement('td');

            // assign elements to parameters (strings)

            td1.innerHTML = ++userNo;
            td2.innerHTML = course;
            td3.innerHTML = department;
            td4.innerHTML = fullname;
            td5.innerHTML = year;
            td6.innerHTML = time;
            // td6.innerHTML = number;
            // td7.innerHTML = time;

            // add trow on tbody
            tbody.appendChild(trow);

            // add cells to row 
            trow.appendChild(td1);
            trow.appendChild(td2);
            trow.appendChild(td3);
            trow.appendChild(td4);
            trow.appendChild(td5);
            trow.appendChild(td6);
            // trow.appendChild(td7);

        }

        // Add all items to the table using foreach loop
        function addAllItemsToTable(Users) {
            userNo = 0;
            tbody.innerHTML = "";

            Users.forEach(element => {
                AddItemToTable(element.course, element.department, element.fullname, element.year, element.time);
            });

        }

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCuhKZnbFdVOrnrRNyOPLmJ8KsISrpIlic",
            authDomain: "csg-attendance.firebaseapp.com",
            databaseURL: "https://csg-attendance-default-rtdb.firebaseio.com",
            projectId: "csg-attendance",
            storageBucket: "csg-attendance.appspot.com",
            messagingSenderId: "913037396545",
            appId: "1:913037396545:web:44d0927ee7ea4ad3f7d4c0",
            measurementId: "G-MD3YG277WR"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        import { getDatabase, ref, child, onValue, get }
            from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";

        const db = getDatabase();


        // Getting the data 
        function getAllDataOnce() {
            const dbRef = ref(db);

            get(child(dbRef, 'SENIOR HIGH | Afternoon OUT')).then((snapshot) => {
                // array of users and forEach loop to take the snapshots
                let users = [];

                // snapshot object in an array to get all the records. 
                // childSnapshot brings 1 value on each data from the database
                snapshot.forEach(childSnapshot => {
                    users.push(childSnapshot.val());
                });

                addAllItemsToTable(users);

            });
        }

        // Getting the data realtime
        function getAllDataRealtime() {
            const dbRef = ref(db, 'SENIOR HIGH | Morning OUT');

            onValue(dbRef, (snapshot) => {
                let users = [];

                snapshot.forEach(childSnapshot => {
                    users.push(childSnapshot.val());
                });

                addAllItemsToTable(users);

            });
        }


        window.onload = getAllDataRealtime;


    </script>

    <script src="js/excelConfig.js"></script>
    <script src="js/table2excel.js"></script>

</body>

</html>